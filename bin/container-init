#!/bin/bash

#[[ "$#" != "2" ]] && exit

#export NODE_IP=$1
#export MASTER_IP=$2
#export HOME=/root

function init {

	service ssh start
	ssh 0.0.0.0 true >/dev/null 2>&1

	#while true; do
	#	sleep 10 #ping ${MASTER_IP} -c 1 -w 2 && break
	#done

	if [[ "`hostname`" == "nat-master" ]]; then
		true
	else
		true
	fi

	#[[ -e "/init" ]] && /init >/dev/null 2>&1 || true
	
	LOGS="/root/.docklet/logs"
	mkdir -p ${LOGS}
	
	FOLDER="/etc/docklet-autostart"
	AUTOSTART="`ls ${FOLDER}`"
	
	for FILE in ${AUTOSTART}; do
		bash ${FOLDER}/${FILE} >> ${LOGS}/${NODE_IP}-${FILE}-stdout 2>> ${LOGS}/${NODE_IP}-${FILE}-stderr
	done

	cd /root && bash
}

init && exit

