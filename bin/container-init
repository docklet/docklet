#!/bin/bash

[[ "$#" != "2" ]] && exit

export NODE_IP=$1
export MASTER_IP=$2
export HOME=/root

function init {

	service ssh start

	while true; do
		ping ${MASTER_IP} -c 4 -w 20 && break
	done

	if [[ "`hostname`" == "nat-master" ]]; then
	
		echo -e '123456\n123456\n' | passwd root
		
		true
	else
		true
	fi
	
	LOGS="/root/.docklet/logs"
	mkdir -p ${LOGS}
	
	FOLDER="/etc/docklet-autostart"
	AUTOSTART="`ls ${FOLDER}`"
	
	for FILE in ${AUTOSTART}; do
		bash ${FOLDER}/${FILE} >> ${LOGS}/${NODE_IP}-${FILE}-stdout 2>> ${LOGS}/${NODE_IP}-${FILE}-stderr
	done

	cd /root && bash
}

init && exit

