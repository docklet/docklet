#!/bin/bash

function init {

	service ssh start

	while true; do
		ping docklet-cloud -c 1 -w 2 && break
	done

	ssh nat-master true

	if [[ "`hostname`" == "nat-master" ]]; then
		true
	else
		true
	fi

	#[[ -e "/init" ]] && /init >/dev/null 2>&1 || true
	
	LOGS="/root/.docklet/logs"
	mkdir -p ${LOGS}
	
	FOLDER="/etc/docklet-autostart"
	AUTOSTART="`ls ${FOLDER}`"
	
	for FILE in ${AUTOSTART}; do
		bash ${FOLDER}/${FILE} >> ${LOGS}/${NODE_IP}-${FILE}-stdout 2>> ${LOGS}/${NODE_IP}-${FILE}-stderr
	done

	cd /root && bash
}

init && exit

