#!/bin/bash

set -e

[[ "$#" != "1" ]] && exit 1

. /etc/docklet/docklet.conf

CONT_ID=`docker inspect "$@" 2>/dev/null | grep Id.: | awk -F\" '{print $4}'`

[[ "${CONT_ID}" == "" ]] && exit 1

[[ ! -e "/sys/fs/cgroup/cpuacct/lxc/${CONT_ID}/cpuacct.usage" ]] && exit 1
CPU_ACCT=`cat /sys/fs/cgroup/cpuacct/lxc/${CONT_ID}/cpuacct.usage`

[[ ! -e "/sys/fs/cgroup/memory/lxc/${CONT_ID}/memory.usage_in_bytes" ]] && exit 1
MEM_USAGE=`cat /sys/fs/cgroup/memory/lxc/${CONT_ID}/memory.usage_in_bytes`

echo -e "${CPU_ACCT}\n${MEM_USAGE}"

