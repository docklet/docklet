<meta http-equiv="content-type" content="text/html;charset=utf-8" />
<head><title>Docklet Doc</title></head>

<h1>Docklet 说明文档 - 2015/3/6</h1> <hr/>

<h2>@ 第一步，创建私有的集群：</h2>
<p style="margin-left:20px">进入 http://docklet.unias.org/ ，点击"Images"，选择一个合适的镜像点击"Start Image"；</p>
<p style="color:red;margin-left:20px">完成创建后会得到一个集群的入口，如：192.168.0.10，是 Open SSH Server 的登录入口。</p>

<hr/>

<h2>@ 第二步，用密钥登录你的集群入口：</h2>

<p style="color:red">说明：十分不推荐在集群内部为root设置密码（即 passwd root），这会导致私有集群的每个节点都可能存在安全隐患。</p>

<h3 style="margin-top:30px">1、浏览器通用登录方式（Windows 推荐）：火狐浏览器 / 谷歌浏览器</h3>

<p style="font-weight:bold;margin-left:20px">a) 火狐浏览器登录</p>
<p style="margin-left:20px">在浏览器中打开你的入口IP，如：ssh://192.168.0.10/ ，用户名填写 root，“浏览”选择本地私钥文件(user.key)，点击"确定"登录。</p>
<p style="color:red;margin-left:20px">注意：请确保已经安装FireSSH插件！ <a href="http://docklet.unias.org/firessh@nightlight.ws.xpi">点此安装 FireSSH for Firefox</a></p>
<p style="font-weight:bold;margin-left:20px;margin-top:30px">b) 谷歌浏览器登录</p>
<p style="margin-left:20px">打开SecureShell扩展应用，填写入口IP如 root@192.168.0.10，并在认证(Identity)栏中导入(Import)本地私钥文件(user.key)即可连接到入口。</p>
<p style="color:red;margin-left:20px">注意：请确保已经添加SecureShell插件！ <a href="https://chrome.google.com/webstore/detail/secure-shell/pnhechapfaindjhompbnflcldabbghjo?utm_campaign=en&utm_source=en-et-na-us-oc-webstrapp&utm_medium=et">从谷歌应用市场安装 SecureShell for Chrome</a></p>


<h3 style="margin-top:40px">2、Unix 终端登录方式（Linux/Mac 推荐）： Open SSH 客户端</h3>

<p style="margin-left:20px">在终端下执行正常的SSH远程链接即可登录，如：</p>
<p style="font-weight:bold;margin-left:40px">ssh -i ./user.key root@192.168.0.10</p>

<p style="color:red;margin-left:20px">注意：如果提示 "WARNING: UNPROTECTED PRIVATE KEY FILE!" 无法免密登录SSH，请设置私有权限保护你的私钥，然后重新尝试登录：</p>
<p style="font-weight:bold;margin-left:40px">chmod go-rw ./user.key</p>


<h3 style="margin-top:40px">3、第三方SSH客户端登录方式： Putty, Bitvise SSH, ...</h3>

<p style="color:red;margin-left:20px;margin-top:30px;margin-bottom:30px">注意：第三方 SSH 客户端可能不支持证书认证方式登录。</p>

<hr/>

<div style="margin-top: 60px" />

<h2>@ 扩展：从集群上传下载文件：</h2>
<p style="margin-left:20px">从本地上传文件到云主机：scp local-file root@portal-ip:~/</p>
<p></p>
<p style="margin-left:20px">从云主机下载文件到本地：scp root@portal-ip:~/remote-file ./</p>
<p></p>
<p style="margin-left:20px">从云主机下载ssh的免密码登录证书：scp root@portal-ip:~/.ssh/id_rsa ./user.key</p>

<p style="margin-left:20px;margin-top:30px;margin-bottom:30px;font-weight:bold">所有docklet实例中只有/root目录是永久可靠的存储环境，且在多hosts间完全共享。</p>

<hr/>

<h2>@ 扩展：将个人配置好的云主机保存为镜像：</h2>

<p style="margin-left:20px">在云主机的nat-master节点将所有依赖、配置文件等设置完整；</p>
<p style="margin-left:20px">然后打开"Clusters"，选择配置好的云主机，点击"Save Master as Image .." 起一个名字即可创建；</p>
<p style="margin-left:20px">对于个人创建的镜像，在"Images"中可以通过"Switch Access"来设定是否共享为他人所使用。</p>

<hr/>

<h2>@ 扩展：使用私有集群（假设你的云主机portal为：192.168.192.100）</h2>
<div style="margin-top: 50px" />

<h3>1、Nginx 网站示例（创建 python2-nginx 实例）：</h3>

<p># echo 'hello world' > /usr/share/nginx/html/index.html</p>
<p></p>
<p>此时外网可通过portal访问：http://192.168.192.100/，显示首网页信息</p>

<hr/>

<h3>2、Python2 编程示例（创建 python2-nginx 实例）：</h3>

<p>Python程序运行：</p>
<p># echo 'print "Hello World"' > ~/test.py</p>
<p># python2 ~/test.py</p>
<p></p>

<hr/>

<h3>3、Python FTP示例（创建 python2-nginx 实例）：</h3>
<p>开启个人FTP主目录：</p>
<p># cd /usr/share</p>
<p># python2 -m SimpleHTTPServer 81</p>
<p>此时外网可通过portal访问：http://192.168.192.100:81/，显示所在目录的文件列表</p>

<hr/>

<h3>4、Spark Shell 示例（创建 jdk7-akka-spark 实例）：</h3>

<p>单机独立模式：# spark-shell</p>
<p>多机集群模式：# spark-shell --master spark://nat-master:7077</p>

<hr/>

<h3>5、Spark 编程示例（创建 jdk7-akka-spark 实例）：</h3>

<p>编写spark代码，如 /usr/local/examples/src/main/scala/org/apache/spark/examples/SparkPi.scala，然后：</p>
<p># spark-compile /usr/local/examples/src/main/scala/org/apache/spark/examples/SparkPi.scala</p>
<p># spark-submit --master spark://nat-master:7077 --class org.apache.spark.examples.SparkPi ./org.apache.spark.examples.SparkPi.jar</p>
<p></p>
<p>Spark 管理界面：http://192.168.192.100:8080/</a></p>

<hr/>

<h3>6、Java7 编程示例（创建 jdk7-akka-spark 实例）：</h3>

<p>保存如下内容至Main.java</p>
<textarea style="width:700px;height:120px">
public class Main {
	public static void main(String []args) {
		System.out.println("Hello World");
	}
}
</textarea>
<p>编译运行：</p>
<p># javac Main.java && java Main</p>

<hr/>

<h3>7、Akka 编程示例（创建 jdk7-akka-spark 实例）：</h3>

<p>保存如下内容至 MyAkka.scala</p>

<textarea style="width:700px;height:280px">
import akka.actor._

class Hello extends Actor {
	def receive = {
		case msg: String => println("Hello, " + msg + "!")
		case _ => println("[unexpected message.]")
	}
}

object MyAkka {
	def main(args: Array[String]) {
		val system = ActorSystem("HelloSystem")
		val hello = system.actorOf(Props[Hello])
		hello ! "10086"
	}
}
</textarea>
<p>编译运行：</p>
<p># spark-compile -e MyAkka.scala</p>

<hr/>


<h3>8、C/C++ 编程示例（创建 gxx-mpi 实例）：</h3>
<p># echo 'main() { puts("Hello World"); }' > main.c</p>
<p># gcc main.c && ./a.out</p>

<hr/>


<h3>9、MPI 编程示例（创建 gxx-mpi 实例）：</h3>

<p>保存如下内容至mpi.cpp</p>
<textarea style="width:700px;height:320px">
#include <stdio.h>
#include <mpi.h>

int main (int argc, char *argv[])
{
	int myid, numprocs, namelen;
	char processor_name[MPI_MAX_PROCESSOR_NAME];

	MPI_Init (&argc, &argv);        /* starts MPI */
	MPI_Comm_rank (MPI_COMM_WORLD, &myid);  /* get current process id */
	MPI_Comm_size (MPI_COMM_WORLD, &numprocs);      /* get number of processes */
	MPI_Get_processor_name(processor_name,&namelen);

	if(myid == 0) printf("number of processes: %d\n",numprocs);
	printf( "%s: Hello world from process %d \n", processor_name, myid);

	MPI_Finalize();
}
</textarea>

<p>编译运行：</p>
<p># mpic++ mpi.cpp && mpiexec -hosts $(docklet hosts) -n 4 ./a.out</p>

<hr/>



<div style="margin-bottom: 400px" />

</body>

